<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generator Prompt Karakter</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* CSS Variables for Light Mode - Minimalist */
        :root {
            --bg-body: #f8fafc; /* Sangat terang, bersih */
            --bg-header: #ffffff;
            --bg-container: #ffffff;
            --bg-section: #f0f4f8; /* Sedikit abu-abu untuk kontras halus */
            --text-primary: #334155; /* Darker text for readability */
            --text-secondary: #64748b; /* Medium gray for secondary text */
            --border-color: #e2e8f0; /* Soft border */
            --input-bg: #ffffff;
            --input-border: #cbd5e1; /* Light gray border */
            --input-border-focus: #4f46e5; /* Primary purple */
            --button-primary-bg: #6366f1;
            --button-primary-hover-bg: #4f46e5;
            --button-copy-bg: #e0e7ff;
            --button-copy-color: #4f46e5;
            --button-copy-hover-bg: #c7d2fe;
            --copied-message-bg: #10b981;
            --typo-bg: #fffbeb;
            --typo-border: #fcd34d;
            --typo-color: #b45309;
            --main-title-color: #1e293b; /* Darker for strong presence */
            --header-shadow: 0 2px 8px rgba(0,0,0,0.05);
            --bg-footer: #ffffff;
            --text-footer: #64748b;
            --footer-border-top: 1px solid #e2e8f0;
        }

        /* CSS Variables for Dark Mode - Refined Gradient Minimalist */
        body.dark-mode {
            --bg-body: linear-gradient(135deg, #1a202c 0%, #2d3748 100%); /* Subtle, elegant gradient */
            --bg-header: #2d3748;
            --bg-container: #2d3748;
            --bg-section: #374151; /* Slightly lighter than container for depth */
            --text-primary: #e2e8f0; /* Light text */
            --text-secondary: #94a3b8; /* Lighter gray text */
            --border-color: #4a5568;
            --input-bg: #2d3748;
            --input-border: #4a5568;
            --input-border-focus: #818cf8;
            --button-primary-bg: #4c51bf;
            --button-primary-hover-bg: #3c4190;
            --button-copy-bg: #4a5568; /* Darker copy button */
            --button-copy-color: #e2e8f0;
            --button-copy-hover-bg: #5a67d8;
            --copied-message-bg: #059669;
            --typo-bg: #4a320a;
            --typo-border: #92400e;
            --typo-color: #fbd38d;
            --main-title-color: #e2e8f0; /* Light text for dark mode title */
            --header-shadow: 0 2px 8px rgba(0,0,0,0.3);
            --bg-footer: #2d3748;
            --text-footer: #94a3b8;
            --footer-border-top: 1px solid #4a5568;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-body); /* Use background for gradient */
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            padding: 0;
            color: var(--text-primary);
            transition: background 0.5s ease, color 0.3s ease; /* Smooth transition for gradient */
        }

        header {
            width: 100%;
            background-color: var(--bg-header);
            padding: 1rem 2rem;
            box-shadow: var(--header-shadow);
            display: flex;
            justify-content: flex-end;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
        }

        .main-content-wrapper {
            padding: 20px;
            width: 100%;
            max-width: 900px;
            display: flex;
            flex-direction: column;
            align-items: center;
            flex-grow: 1;
        }

        .container {
            background-color: var(--bg-container);
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            padding: 32px;
            max-width: 900px;
            width: 100%;
            display: grid;
            grid-template-columns: 1fr;
            gap: 24px;
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
            margin-top: 24px;
        }
        @media (min-width: 768px) {
            .container {
                grid-template-columns: 1fr 1fr;
            }
        }
        .form-section, .output-section {
            padding: 16px;
            border-radius: 12px;
            background-color: var(--bg-section);
            border: 1px solid var(--border-color);
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }
        .form-group label {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
            display: block;
        }
        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--input-border);
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease, box-shadow 0.3s ease, background-color 0.3s ease, color 0.3s ease;
            background-color: var(--input-bg);
            color: var(--text-primary);
        }
        .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
            outline: none;
            border-color: var(--input-border-focus);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.25);
        }
        .btn-primary {
            background-color: var(--button-primary-bg);
            color: #ffffff;
            padding: 14px 24px;
            border-radius: 10px;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            box-shadow: 0 4px 10px rgba(99, 102, 241, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .btn-primary:hover {
            background-color: var(--button-primary-hover-bg);
            transform: translateY(-2px);
        }
        .btn-primary:active {
            transform: translateY(0);
            box-shadow: 0 2px 5px rgba(99, 102, 241, 0.3);
        }
        .output-box {
            background-color: var(--bg-container);
            border: 1px solid var(--input-border);
            border-radius: 8px;
            padding: 16px;
            min-height: 100px;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-size: 15px;
            color: var(--text-primary);
            position: relative;
            transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease;
        }
        .output-box.loading::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 40px;
            height: 40px;
            border: 4px solid var(--border-color);
            border-top: 4px solid var(--input-border-focus);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        .output-box.loading {
            color: transparent;
        }
        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }
        .copy-button {
            background-color: var(--button-copy-bg);
            color: var(--button-copy-color);
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s ease, color 0.2s ease;
            position: absolute;
            top: 8px;
            right: 8px;
        }
        .copy-button:hover {
            background-color: var(--button-copy-hover-bg);
        }
        .copy-button:active {
            transform: translateY(1px);
        }
        .copied-message {
            position: absolute;
            bottom: 8px;
            right: 8px;
            background-color: var(--copied-message-bg);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }
        .copied-message.show {
            opacity: 1;
        }
        .typo-notification {
            background-color: var(--typo-bg);
            border: 1px solid var(--typo-border);
            color: var(--typo-color);
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 16px;
            font-size: 14px;
            display: flex;
            align-items: center;
            transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease;
        }
        .typo-notification strong {
            margin-right: 8px;
        }

        /* Custom styles for the main title and subtitle (minimalist) */
        .main-title {
            font-size: 2.25rem;
            font-weight: 700;
            color: var(--main-title-color);
            letter-spacing: -0.01em;
            margin-top: 2rem;
            margin-bottom: 0.25rem;
            text-shadow: none;
            transition: color 0.3s ease;
        }

        .sub-title {
            font-size: 1rem;
            font-weight: 400;
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
            line-height: 1.5;
            transition: color 0.3s ease;
        }

        /* Dark Mode Toggle Button */
        #darkModeToggle {
            background-color: var(--bg-section);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        #darkModeToggle:hover {
            background-color: var(--border-color);
        }

        /* Footer styles */
        footer {
            width: 100%;
            background-color: var(--bg-footer);
            padding: 1.5rem 2rem;
            margin-top: auto; /* Pushes footer to the bottom */
            text-align: center;
            font-size: 0.9rem;
            color: var(--text-footer);
            border-top: var(--footer-border-top);
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }
    </style>
</head>
<body>
    <header>
        <button id="darkModeToggle">
            <svg id="sunIcon" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h1M3 12h1m15.325-4.275l-.707-.707M4.372 19.372l-.707-.707M19.071 4.929l-.707.707M4.929 19.071l-.707.707M18 12a6 6 0 11-12 0 6 6 0 0112 0z" />
            </svg>
            <svg id="moonIcon" class="h-5 w-5 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9 9 0 008.354-5.646z" />
            </svg>
            <span id="toggleText">Dark Mode</span>
        </button>
    </header>

    <div class="main-content-wrapper">
        <h2 class="main-title text-center">Generator Prompt Karakter</h2>
        <h3 class="sub-title text-center">Membuat prompt karakter konsisten secara otomatis berdasarkan input pengguna.</h3>

        <div class="container">
            <div class="form-section">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">Form Identitas Karakter</h2>
                <form id="characterForm" class="space-y-4">
                    <div class="form-group">
                        <label for="namaKarakter">1. Nama Karakter:</label>
                        <input type="text" id="namaKarakter" placeholder="Contoh: Miko, Dewi" class="rounded-lg">
                    </div>
                    <div class="form-group">
                        <label for="usia">2. Usia:</label>
                        <input type="text" id="usia" placeholder="Contoh: 8 tahun / remaja / dewasa muda" class="rounded-lg">
                    </div>
                    <div class="form-group">
                        <label for="jenisKelamin">3. Jenis Kelamin:</label>
                        <select id="jenisKelamin" class="rounded-lg">
                            <option value="">Pilih</option>
                            <option value="Laki-laki">Laki-laki</option>
                            <option value="Perempuan">Perempuan</option>
                            <option value="Non-biner">Non-biner</option>
                            <option value="Tidak disebutkan">Tidak disebutkan</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="rasEtnis">4. Ras / Etnis:</label>
                        <input type="text" id="rasEtnis" placeholder="Misalnya: Asia Tenggara, Afrika, Kaukasia" class="rounded-lg">
                    </div>
                    <div class="form-group">
                        <label for="warnaKulit">5. Warna Kulit:</label>
                        <input type="text" id="warnaKulit" placeholder="Deskripsi spesifik, misalnya: medium tan, putih kemerahan" class="rounded-lg">
                    </div>
                    <div class="form-group">
                        <label for="warnaGayaRambut">6. Warna dan Gaya Rambut:</label>
                        <input type="text" id="warnaGayaRambut" placeholder="Misal: hitam panjang sebahu, keriting cokelat pendek" class="rounded-lg">
                    </div>
                    <div class="form-group">
                        <label for="warnaBentukMata">7. Warna dan Bentuk Mata:</label>
                        <input type="text" id="warnaBentukMata" placeholder="Contoh: mata bulat besar warna hazel, sipit hitam pekat" class="rounded-lg">
                    </div>
                    <div class="form-group">
                        <label for="ciriKhasWajah">8. Ciri Khas Wajah:</label>
                        <input type="text" id="ciriKhasWajah" placeholder="Contoh: pipi chubby, hidung pesek, tahi lalat di bawah mata" class="rounded-lg">
                    </div>
                    <div class="form-group">
                        <label for="aksesori">9. Aksesori Wajah / Tubuh:</label>
                        <input type="text" id="aksesori" placeholder="Contoh: anting hoop, kacamata bulat, kalung liontin" class="rounded-lg">
                    </div>
                    <div class="form-group">
                        <label for="pakaianUtama">10. Pakaian Utama:</label>
                        <textarea id="pakaianUtama" rows="2" placeholder="Deskripsi jelas: warna, bahan, gaya. Misalnya: kaos putih oversized dan celana denim biru" class="rounded-lg"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="gayaBusana">11. Gaya Busana Umum:</label>
                        <input type="text" id="gayaBusana" placeholder="Kasual, formal, fantasi, cyberpunk, anak-anak" class="rounded-lg">
                    </div>
                    <div class="form-group">
                        <label for="poseEkspresi">12. Pose atau Ekspresi Favorit:</label>
                        <input type="text" id="poseEkspresi" placeholder="Contoh: tersenyum ceria, cemberut lucu, duduk sambil melamun" class="rounded-lg">
                    </div>
                    <div class="form-group">
                        <label for="aktivitasProperti">13. Aktivitas atau Properti Khas:</label>
                        <input type="text" id="aktivitasProperti" placeholder="Misal: memegang boneka, membawa tas ransel, sedang bermain" class="rounded-lg">
                    </div>
                    <div class="form-group">
                        <label for="lingkunganLatar">14. Lingkungan atau Latar Umum:</label>
                        <input type="text" id="lingkunganLatar" placeholder="Misalnya: taman bermain, kamar tidur pink, hutan gelap" class="rounded-lg">
                    </div>
                    <div class="form-group">
                        <label for="gayaIlustrasi">15. Gaya Ilustrasi:</label>
                        <input type="text" id="gayaIlustrasi" placeholder="Contoh: 3D cartoon ala Pixar, anime gloomy, semi-realistic painting" class="rounded-lg">
                    </div>
                    <div class="form-group">
                        <label for="moodNuansa">16. Mood atau Nuansa:</label>
                        <input type="text" id="moodNuansa" placeholder="Hangat dan menyenangkan / gelap dan misterius / imut dan menenangkan" class="rounded-lg">
                    </div>
                    <button type="submit" class="btn-primary w-full" id="generateButton">
                        <span id="buttonText">Hasilkan Prompt</span>
                        <span id="loadingSpinner" class="hidden h-5 w-5 border-4 border-white border-t-transparent rounded-full ml-2"></span>
                    </button>
                </form>
            </div>

            <div class="output-section space-y-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">Hasil Prompt</h2>

                <div id="typoNotification" class="hidden typo-notification" role="alert">
                    <strong class="font-bold">Perhatian!</strong>
                    <span class="block sm:inline" id="typoMessage"></span>
                </div>

                <div>
                    <label class="font-semibold text-gray-700 mb-2 block">Narasi Deskriptif Karakter:</label>
                    <div id="narasiOutput" class="output-box relative">
                        <button class="copy-button" onclick="copyToClipboard('narasiOutput', this)">Salin</button>
                        <span class="copied-message">Disalin!</span>
                    </div>
                </div>

                <div>
                    <label class="font-semibold text-gray-700 mb-2 block">Prompt Bahasa Indonesia:</label>
                    <div id="promptIdOutput" class="output-box relative">
                        <button class="copy-button" onclick="copyToClipboard('promptIdOutput', this)">Salin</button>
                        <span class="copied-message">Disalin!</span>
                    </div>
                </div>

                <div>
                    <label class="font-semibold text-gray-700 mb-2 block">Prompt Bahasa Inggris:</label>
                    <div id="promptEnOutput" class="output-box relative">
                        <button class="copy-button" onclick="copyToClipboard('promptEnOutput', this)">Salin</button>
                        <span class="copied-message">Disalin!</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer>
        Â© 2025 Dodi Outright. All rights reserved.
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const darkModeToggle = document.getElementById('darkModeToggle');
            const sunIcon = document.getElementById('sunIcon');
            const moonIcon = document.getElementById('moonIcon');
            const toggleText = document.getElementById('toggleText');

            // Check for saved theme preference or system preference
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark' || (!savedTheme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.body.classList.add('dark-mode');
                sunIcon.classList.add('hidden');
                moonIcon.classList.remove('hidden');
                toggleText.textContent = 'Light Mode';
            } else {
                document.body.classList.remove('dark-mode');
                sunIcon.classList.remove('hidden');
                moonIcon.classList.add('hidden');
                toggleText.textContent = 'Dark Mode';
            }

            darkModeToggle.addEventListener('click', () => {
                document.body.classList.toggle('dark-mode');
                if (document.body.classList.contains('dark-mode')) {
                    localStorage.setItem('theme', 'dark');
                    sunIcon.classList.add('hidden');
                    moonIcon.classList.remove('hidden');
                    toggleText.textContent = 'Light Mode';
                } else {
                    localStorage.setItem('theme', 'light');
                    sunIcon.classList.remove('hidden');
                    moonIcon.classList.add('hidden');
                    toggleText.textContent = 'Dark Mode';
                }
            });
        });


        document.getElementById('characterForm').addEventListener('submit', async function(event) {
            event.preventDefault(); // Prevents the form from submitting normally

            // Retrieve values from each input
            const characterData = {
                namaKarakter: document.getElementById('namaKarakter').value,
                usia: document.getElementById('usia').value,
                jenisKelamin: document.getElementById('jenisKelamin').value,
                rasEtnis: document.getElementById('rasEtnis').value,
                warnaKulit: document.getElementById('warnaKulit').value,
                warnaGayaRambut: document.getElementById('warnaGayaRambut').value,
                warnaBentukMata: document.getElementById('warnaBentukMata').value,
                ciriKhasWajah: document.getElementById('ciriKhasWajah').value,
                aksesori: document.getElementById('aksesori').value,
                pakaianUtama: document.getElementById('pakaianUtama').value,
                gayaBusana: document.getElementById('gayaBusana').value,
                poseEkspresi: document.getElementById('poseEkspresi').value,
                aktivitasProperti: document.getElementById('aktivitasProperti').value,
                lingkunganLatar: document.getElementById('lingkunganLatar').value,
                gayaIlustrasi: document.getElementById('gayaIlustrasi').value,
                moodNuansa: document.getElementById('moodNuansa').value
            };

            // Display loading spinner and clear output
            const generateButton = document.getElementById('generateButton');
            const buttonText = document.getElementById('buttonText');
            const loadingSpinner = document.getElementById('loadingSpinner');
            const narasiOutput = document.getElementById('narasiOutput');
            const promptIdOutput = document.getElementById('promptIdOutput');
            const promptEnOutput = document.getElementById('promptEnOutput');
            const typoNotification = document.getElementById('typoNotification');
            const typoMessage = document.getElementById('typoMessage');

            buttonText.textContent = 'Menghasilkan...';
            loadingSpinner.classList.remove('hidden'); // Show spinner
            generateButton.disabled = true;

            narasiOutput.classList.add('loading');
            promptIdOutput.classList.add('loading');
            promptEnOutput.classList.add('loading');

            narasiOutput.innerHTML = '<button class="copy-button" onclick="copyToClipboard(\'narasiOutput\', this)">Salin</button><span class="copied-message">Disalin!</span>';
            promptIdOutput.innerHTML = '<button class="copy-button" onclick="copyToClipboard(\'promptIdOutput\', this)">Salin</button><span class="copied-message">Disalin!</span>';
            promptEnOutput.innerHTML = '<button class="copy-button" onclick="copyToClipboard(\'promptEnOutput\', this)">Salin</button><span class="copied-message">Disalin!</span>';

            typoNotification.classList.add('hidden'); // Hide notification on new submission
            typoMessage.textContent = '';

            try {
                // Create prompt for LLM with auto-correction and consistency focus
                let prompt = `Berdasarkan informasi karakter berikut, yang mungkin mengandung typo atau kesalahan penulisan, harap lakukan koreksi otomatis secara cerdas dan inferensi makna yang benar. Setelah itu, buatlah narasi deskriptif karakter yang utuh, prompt berbahasa Indonesia yang siap digunakan untuk AI art atau text generation, dan prompt berbahasa Inggris yang setara. **Fokus utama adalah pada pembuatan karakter utama yang konsisten di seluruh deskripsi dan prompt.**

Jika Anda mendeteksi adanya potensi typo atau kesalahan penulisan yang Anda koreksi/interpretasi, harap sertakan detailnya di bidang 'typo_details'.

Informasi Karakter:
Nama Karakter: ${characterData.namaKarakter || 'Tidak disebutkan'}
Usia: ${characterData.usia || 'Tidak disebutkan'}
Jenis Kelamin: ${characterData.jenisKelamin || 'Tidak disebutkan'}
Ras / Etnis: ${characterData.rasEtnis || 'Tidak disebutkan'}
Warna Kulit: ${characterData.warnaKulit || 'Tidak disebutkan'}
Warna dan Gaya Rambut: ${characterData.warnaGayaRambut || 'Tidak disebutkan'}
Warna dan Bentuk Mata: ${characterData.warnaBentukMata || 'Tidak disebutkan'}
Ciri Khas Wajah: ${characterData.ciriKhasWajah || 'Tidak disebutkan'}
Aksesori Wajah / Tubuh: ${characterData.aksesori || 'Tidak disebutkan'}
Pakaian Utama: ${characterData.pakaianUtama || 'Tidak disebutkan'}
Gaya Busana Umum: ${characterData.gayaBusana || 'Tidak disebutkan'}
Pose atau Ekspresi Favorit: ${characterData.poseEkspresi || 'Tidak disebutkan'}
Aktivitas atau Properti Khas: ${characterData.aktivitasProperti || 'Tidak disebutkan'}
Lingkungan atau Latar Umum: ${characterData.lingkunganLatar || 'Tidak disebutkan'}
Gaya Ilustrasi: ${characterData.gayaIlustrasi || 'Tidak disebutkan'}
Mood atau Nuansa: ${characterData.moodNuansa || 'Tidak disebutkan'}

Format output harus berupa JSON dengan kunci 'narasi', 'prompt_id', 'prompt_en', 'typo_detected' (boolean), dan 'typo_details' (string, kosong jika tidak ada typo, berisi detail koreksi jika ada).`;

                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });

                const payload = {
                    contents: chatHistory,
                    generationConfig: {
                        responseMimeType: "application/json",
                        responseSchema: {
                            type: "OBJECT",
                            properties: {
                                "narasi": { "type": "STRING" },
                                "prompt_id": { "type": "STRING" },
                                "prompt_en": { "type": "STRING" },
                                "typo_detected": { "type": "BOOLEAN" },
                                "typo_details": { "type": "STRING" }
                            },
                            required: ["narasi", "prompt_id", "prompt_en", "typo_detected", "typo_details"]
                        }
                    }
                };

                // IMPORTANT: Replace "YOUR_API_KEY_HERE" with your actual Google Cloud API Key if self-hosting.
                // This API key is automatically provided by Canvas at runtime, but must be explicitly
                // set when deploying to your own server.
                const apiKey = "AIzaSyCI8gH3KftmB_mEhg9sCrdDWA1S02VbOEk"; // <--- REPLACE THIS WITH YOUR ACTUAL API KEY IF HOSTING OUTSIDE CANVAS

                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const jsonString = result.candidates[0].content.parts[0].text;
                    const parsedJson = JSON.parse(jsonString);

                    // Display results
                    narasiOutput.innerHTML = `${parsedJson.narasi}<button class="copy-button" onclick="copyToClipboard('narasiOutput', this)">Salin</button><span class="copied-message">Disalin!</span>`;
                    promptIdOutput.innerHTML = `${parsedJson.prompt_id}<button class="copy-button" onclick="copyToClipboard('promptIdOutput', this)">Salin</button><span class="copied-message">Disalin!</span>`;
                    promptEnOutput.innerHTML = `${parsedJson.prompt_en}<button class="copy-button" onclick="copyToClipboard('promptEnOutput', this)">Salin</button><span class="copied-message">Disalin!</span>`;

                    // Display typo notification if detected
                    if (parsedJson.typo_detected) {
                        typoNotification.classList.remove('hidden');
                        typoMessage.textContent = parsedJson.typo_details;
                    } else {
                        typoNotification.classList.add('hidden');
                        typoMessage.textContent = '';
                    }

                } else {
                    narasiOutput.textContent = 'Gagal menghasilkan narasi. Struktur respons tidak terduga.';
                    promptIdOutput.textContent = 'Gagal menghasilkan prompt ID. Struktur respons tidak terduga.';
                    promptEnOutput.textContent = 'Gagal menghasilkan prompt EN. Struktur respons tidak terduga.';
                    typoNotification.classList.remove('hidden');
                    typoMessage.textContent = 'Terjadi kesalahan internal saat memproses input atau menghasilkan prompt.';
                    console.error('Unexpected API response structure:', result);
                }

            } catch (error) {
                console.error('Error fetching data from Gemini API:', error);
                narasiOutput.textContent = 'Terjadi kesalahan saat menghubungi API. Silakan coba lagi.';
                promptIdOutput.textContent = 'Terjadi kesalahan saat menghubungi API. Silakan coba lagi.';
                promptEnOutput.textContent = 'Terjadi kesalahan saat menghubungi API. Silakan coba lagi.';
                typoNotification.classList.remove('hidden');
                typoMessage.textContent = 'Terjadi kesalahan jaringan atau API. Silakan periksa koneksi Anda dan coba lagi.';
            } finally {
                // Hide loading spinner and re-enable button
                buttonText.textContent = 'Hasilkan Prompt';
                loadingSpinner.classList.add('hidden'); // Hide spinner
                generateButton.disabled = false;

                narasiOutput.classList.remove('loading');
                promptIdOutput.classList.remove('loading');
                promptEnOutput.classList.remove('loading');
            }
        });

        // Function to copy text to clipboard
        function copyToClipboard(elementId, buttonElement) {
            const element = document.getElementById(elementId);
            // Get the text content, excluding the copy button's text and the copied message
            const textToCopy = element.childNodes[0].textContent.trim();

            const textarea = document.createElement('textarea');
            textarea.value = textToCopy;
            textarea.style.position = 'fixed'; // Avoid scrolling to bottom
            textarea.style.opacity = 0;
            document.body.appendChild(textarea);
            textarea.focus();
            textarea.select();
            try {
                document.execCommand('copy');
                const copiedMessage = buttonElement.nextElementSibling;
                copiedMessage.classList.add('show');
                setTimeout(() => {
                    copiedMessage.classList.remove('show');
                }, 1500);
            } catch (err) {
                console.error('Failed to copy text: ', err);
            } finally {
                document.body.removeChild(textarea);
            }
        }
    </script>
</body>
</html>
